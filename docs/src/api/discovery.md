# Discovery

Project structure analysis and automatic configuration discovery.

## Overview

The Discovery module automatically analyzes project structures to:

- Detect source files and headers
- Identify build patterns
- Discover dependencies
- Generate initial configuration

## Functions

```@docs
JMake.Discovery.discover
```

## Discovery Pipeline

The discovery process follows these stages:

1. **File Scanning**: Recursively find all relevant files
2. **Structure Analysis**: Determine project organization
3. **Pattern Detection**: Identify build patterns
4. **Configuration Generation**: Create `jmake.toml`

## Usage Examples

### Basic Discovery

```julia
using JMake

# Discover project structure
result = JMake.discover("path/to/project")

println("Source files: $(length(result.sources))")
println("Headers: $(length(result.headers))")
println("Build system: $(result.build_system)")
```

### Scan with Auto-Config

```julia
# Scan and generate configuration
JMake.scan(".", generate_config=true)

# Review generated jmake.toml
# Edit as needed
# Compile
JMake.compile()
```

### Custom Discovery

```julia
using JMake.Discovery

# Configure discovery
config = DiscoveryConfig(
    source_extensions = [".cpp", ".cc", ".cxx"],
    header_extensions = [".h", ".hpp", ".hxx"],
    exclude_patterns = ["third_party/*", "build/*"],
    follow_symlinks = false
)

# Run discovery
result = discover(".", config)
```

## Discovery Results

Discovery returns a structure with:

```julia
struct DiscoveryResult
    sources::Vector{String}       # Source files found
    headers::Vector{String}       # Header files found
    include_dirs::Vector{String}  # Inferred include directories
    build_system::Symbol          # :cmake, :make, :autotools, :none
    dependencies::Vector{String}  # Detected dependencies
    entry_points::Vector{String}  # Potential main files
end
```

## Build System Detection

Discovery can detect:

- **CMake**: Presence of `CMakeLists.txt`
- **Make**: Presence of `Makefile`
- **Autotools**: Presence of `configure.ac`
- **Custom**: Based on file patterns

## Pattern Recognition

Discovery identifies common patterns:

- **Single library**: All sources compile to one library
- **Multiple targets**: Separate subdirectories for different libraries
- **Header-only**: Pure header-only libraries
- **Mixed**: Combination of libraries and executables

## Configuration Generation

Based on discovery results, generates:

```toml
# Auto-generated by JMake Discovery
[project]
name = "DetectedProject"
version = "0.1.0"

[compiler]
standard = "c++17"  # Detected from source analysis

[sources]
files = [
    # Discovered source files
    "src/*.cpp"
]
include_dirs = [
    # Inferred include paths
    "include",
    "src"
]

[output]
julia_module = "DetectedProject"
```

## Customization

### Exclude Patterns

```julia
# Exclude specific directories
JMake.scan(".",
    exclude=["vendor/*", "third_party/*", "test/*"]
)
```

### Source Extensions

```julia
# Custom file extensions
config = DiscoveryConfig(
    source_extensions = [".cpp", ".c", ".cu"],  # Include CUDA
    header_extensions = [".h", ".hpp", ".cuh"]
)
```

## Best Practices

1. **Review generated config**: Always check auto-generated `jmake.toml`
2. **Exclude build dirs**: Add build artifacts to exclude patterns
3. **Verify includes**: Check that all include paths are correct
4. **Test compilation**: Verify auto-config works before customizing
5. **Iterate**: Re-run discovery after major structural changes
